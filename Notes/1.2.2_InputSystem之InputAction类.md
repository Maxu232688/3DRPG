# InputSystem之InputAction类

## InputAction是什么

InputAction是InputSystem帮我们封装的输入动作类，它的主要作用是不需要写代码处理输入，而是直接在Inspector窗口中编辑你想输入的类型。\
当输入触发时，我们只需要把精力放在触发后的逻辑中。

如果想要在处理动作，要在类中声明InputAction类的成员变量。\
别忘记引用命名空间。

```csharp
using UnityEngine.InputSystem;

class XXXXX : MonoBehaviour
{
    public InputAction move;
    public InputAction fire;
}
```

将这个脚本挂载到场景中的物体上，就能在Inspector面板上看见可编辑的InputAction。

## InputAction的参数

在Inspector窗口中，可以看到可编辑的Input Action 右边有三个键，齿轮，加号，减号。

### 点击齿轮展开

- Action：输入动作设置，设置检测哪些输入
  - Action Type：有三个选项
    - Value：值类型，主要用于状态连续更改的输入，例如鼠标的移动，手柄的摇杆。如果有多个设备绑定这个Action，只会发送其中一个设备（最受控制的）的输入。
    - Button：按钮类型，用于每次按下时触发的Action
    - Pass Through：直通类型，和Value一样，区别在于如果有多个设备绑定这个Action，会发送所有设备的输入
    - 如果你想获取某一个值的时候，可以选用Value类型，如果只想触发一个事件，那就用Button类型
    - 假如电脑上插了两个手柄，如果使用Value类型，那么只有主手柄输入时才能得到值，如果选择直通类型，两个手柄输入都会得到值
  - Control Type：控制类型。在这里选择对应的类型，之后在选择对应设备按键相关属性时会根据选择的内容不同筛选出对应内容。这上面显示的内容就是各设备属性的返回值类型。当你选择它们后，非选择的类型将不会在之后的按键设置中出现。相当于在这里筛选输入设备。例如 Action Type 选择为 Value，Control Type 选择为Vector 2，那么只有设备返回Vector 2的值时才能获取到。
    - Any：任何值
    - Analog：模拟值，浮点数
    - Axis：一维轴浮点数，如摇杆输入返回值
    - Bone：骨骼
    - Digital：数字
    - Double：浮点
    - Dpad：四向按钮，如摇杆上的D-pad
    - Eyes：VR相关
    - Integer：整数
    - Quaternion：四元数
    - Stick：摇杆
    - Touch：触屏
    - Vector2
    - Vector3
- Interactions：相互作用设置，用于特殊输入，比如长按、多次点击等。当满足条件时才会触发这个行为（设置长按时间，点击次数等）可以新建配置文件改变一些默认值。
  - 三个事件：开始started，触发performed，结束canceled
  - Hold：适用于需要输入设备保持一段时间的操作。当按钮按下会触发started，若在松开按钮前，按住时间大于等于Hold Time则会触发performed（时间一到就触发），否则触发canceled。
  - Multi Tap：用作于多次点击，例如双击或者三连击。Tap Count为点击次数，Max Tap Spacing为每次点击之间的间隔（(默认值为2* Max TapDuration)。Max Tap Duration为每次点击的持续时间，即按下和松开按钮的这段时间。当每次点击时间小于Max Tap Duration，且点击间隔时间小于Max Tap Spacing，点击Tap Count次，触发performed。
  - Press：可以实现类似按钮的操作。**Press Only**:按下的时候触发started和performed。不触发canceled。**Release Only**:按下的时候触发started，松开的时候触发performed。**Press And Release**:按下的时候触发started和performed，松开的时候会再次触发started和performed。不触发canceled。**Press Point**:在Input System中，每个按钮都有对应的浮点值，例如普通的按钮，将会在0(未按下)和1 (按下)之间。因此我们可以利用这个值(Press Point)来进行区分，当大于等于这个值则认为按钮按下了。 
  - Slow Tap：类似Hold，但是它在按住时间大于等于Max Tap Duriation的时候，并不会立刻触发performed，而是会在松开的时候才触发performed。
  - Tap：和Hold相反，需要在一段时间内按下松开来触发。当按钮按下会触发started，若在Max Tap Duriation时间内（小于）松开按钮，触发performed，否则触发canceled。
- Processors：值处理加工设置，对得到的值进行处理加工
  - Clamp：钳制函数，限制值范围到[min, max]之间
  - Invert：反转控件中的值（乘以-1）
  - Invert Vector2：反转控件中的值(即，将值乘以-1)。如果invertX为真，则反转矢量的x轴;如果invertY为真，则反转矢量的y轴。
  - Invert Vector3：反转控件中的值(即，将值乘以-1)。如果反转x为真，则反转矢量的x轴;如果反转y为真，则反转y轴;如果反转z为真，则反转z轴。
  - Normalize：如果最小值>=零，则将[min..max]范围内的输入值规格化为无符号规格化形式[0..1]，如果最小值<零，则将输入值规格化为有符号规格化形式[-1..1]。
  - Normalize Vector2：将输入向量规格化为单位长度。
  - Normalize Vector3：将输入向量规格化为单位长度。
  - Scale：将所有输入值乘以系数
  - Scale Vector2：将所有输入值沿x轴乘以x，沿y轴乘以y。
  - Scale Vector3：将所有输入值沿x轴乘以x，沿y轴乘以y，沿z轴乘以z。
  - Axis Deadzone：axis死区处理器缩放控件的值，使绝对值小于最小值的任何值为0，绝对值大于最大值的任何值为1或-1。许多控件没有精确的静止点（也就是说，当控件位于中心时，它们并不总是精确报告0）。在死区处理器上使用最小值可避免此类控件的无意输入。此外，当轴一直移动时，某些控件不一致地报告其最大值。在死区处理器上使用最大值可确保在这种情况下始终获得最大值。
  - Stick Deadzone：摇杆死区处理器缩放Vector2控件（如摇杆）的值，以便任何幅值小于最小值的输入向量都将得到(0,0)，而任何幅值大于最大值的输入向量都将规格化为长度1。许多控件没有精确的静止点(也就是说，当控件位于中心时，它们并不总是精确地报告0,0)。在死区处理器上使用最小值可避免此类控件的无意输入。此外，当轴一直移动时，某些控件不一致地报告其最大值。在死区处理器上使用最大值可确保在这种情况下始终获得最大值。

### 点击加号键展开

- Add Binding：添加新的输入绑定（单按键输入）
- Add Positive\Negative Binding 或者 Add 1D Axis Composite：添加1D轴组合（类似Input中的水平竖直热键，返回-1~1之间的一个值）
- Add UP\Down\Left\Right Composite 或者 Add 2D Vector Composite：添加2D向量组合（类似将Input中的水平竖直热键组合在一起，得到的Vector中的x，y分别表示两个轴）
- Add Up\Down\Left\Right\Forward\Backward Composite：添加3D向量组合
- Add Button With One Modifier Composite：添加带有一个复合修改器的按钮（可以理解为双组合键，比如Ctrl + C、Ctrl + V）
- Add Button With Two Modifier Composite：添加带有两个复合修改器的按钮（可以理解为三组合键，比如Ctrl + K + U）

## InputAction的使用

```csharp
public InputAction move;

void Start()
{
  // 启用输入检测
  move.Enable(); 
  // 开始操作
  move.started += TestFun; // 少用lambda表达式
  // 真正触发
  move.performed += TestFun; 
  // 结束操作
  move.canceled += TestFun;
  // 如果是值类型返回则可以读取值
  move.ReadValue<float>();
}

private void TestFun(InputAction.CallbackContext context)
{
  // 关键参数 CallbackContext
  // 当前状态
    // 没有启用
    context.phase.Disabled;
    // 等待
    context.phase.Waiting;
    // 开始
    context.phase.Started;
    // 触发
    context.phase.Performed;
    // 结束
    context.phase.Canceled;
  // 动作行为信息
  context.action.name;
  // 控件信息（设备）
  context.control.name;
  // 获取值
  context.ReadValue<Vector2>(); //与上文相同
  // 持续时间
  context.duration;
  context.startTime;
}
```
