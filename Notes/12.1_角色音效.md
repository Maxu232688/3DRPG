# 角色音效

在Player下新建脚本 PlayerAudio

```csharp
[RequireComponent(typeof(Player))]
public class PlayerAudio : MonoBehaviour
{
    [Header("Voices")] 
    public AudioClip[] jump;
    public AudioClip[] hurt;
    public AudioClip[] attack;
    public AudioClip[] lift;
    public AudioClip[] maneuver;
    
    [Header("Effects")]
    public AudioClip spin;
    public AudioClip pickUp;
    public AudioClip drop;
    public AudioClip airDive;
    public AudioClip stompSpin;
    public AudioClip stompLanding;
    public AudioClip ledgeGrabbing;
    public AudioClip dash;
    public AudioClip startRailGrind;
    public AudioClip railGrind;

    [Header("Other Sources")] 
    public AudioSource grindAudio;
    
    protected Player m_player;
    protected AudioSource m_audio;

    protected virtual void InitializePlayer() => m_player = GetComponent<Player>();
    
    protected virtual void InitializeAudio()
    {
        if (!TryGetComponent(out m_audio))
        {
            m_audio = gameObject.AddComponent<AudioSource>();
        }
    }
    // 初始化事件监听，事件发送的时候播放对应音效即可
    protected virtual void InitializeCallbacks()
    {
        m_player.playerEvents.OnJump.AddListener(() => PlayRandom(jump));
        m_player.playerEvents.OnHurt.AddListener(() => PlayRandom(hurt));
        m_player.playerEvents.OnThrow.AddListener(() => Play(drop, false));
        m_player.playerEvents.OnStompStarted.AddListener(() => Play(stompSpin, false));
        m_player.playerEvents.OnStompLanding.AddListener(() => Play(stompLanding));
        m_player.playerEvents.OnLedgeGrabbed.AddListener(() => Play(ledgeGrabbing, false));
        m_player.playerEvents.OnLedgeClimbing.AddListener(() => PlayRandom(lift));
        m_player.playerEvents.OnBackflip.AddListener(() => PlayRandom(maneuver));
        m_player.playerEvents.OnDashStarted.AddListener(() => Play(dash));
        m_player.entityEvents.OnRailExit.AddListener(() => grindAudio?.Stop());
        
        m_player.playerEvents.OnPickUp.AddListener(() =>
        {
            PlayRandom(lift);
            m_audio.PlayOneShot(pickUp);
        });
        
        m_player.playerEvents.OnSpin.AddListener(() =>
        {
            PlayRandom(attack);
            m_audio.PlayOneShot(spin);
        });
        
        m_player.playerEvents.OnAirDive.AddListener(() =>
        {
            PlayRandom(lift);
            m_audio.PlayOneShot(airDive);
        });
        
        m_player.entityEvents.OnRailEnter.AddListener(() =>
        {
            Play(startRailGrind, false);
            grindAudio?.Play();
        });
        
        LevelPauser.instance?.OnPause.AddListener(() =>
        {
            m_audio.Pause();
            grindAudio.Pause();
        });
        
        LevelPauser.instance?.OnResume.AddListener(() =>
        {
            m_audio.UnPause();
            grindAudio.UnPause();
        });
    }
    
    protected void Start()
    {
        InitializeAudio();
        InitializePlayer();
        InitializeCallbacks();
    }
    // 随机在几种音效里面播放一种
    protected virtual void PlayRandom(AudioClip[] clips)
    {
        if (clips != null && clips.Length > 0)
        {
            var index = UnityEngine.Random.Range(0, clips.Length);

            if (clips[index])
            {
                Play(clips[index]);
            }
        }
    }
    // 播放音效
    protected virtual void Play(AudioClip clip, bool stopPrevious = true)
    {
        if (clip == null)
        {
            return;
        }

        if (stopPrevious)
        {
            m_audio.Stop();
        }

        m_audio.PlayOneShot(clip);
    }
}
```

按照课程中在Unity中进行拖拽即可。