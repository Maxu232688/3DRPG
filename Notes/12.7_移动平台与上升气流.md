# 移动平台与上升气流

移动平台就是一个普通的cube，通过waypoints来实现它的移动

在Misc中新建脚本 MovingPlatform

```csharp
public class MovingPlatform : MonoBehaviour
{
    public float speed = 3f;
    public WaypointManager waypoints { get; protected set; }
    
    protected virtual void Awake()
    {
        tag = GameTags.Platform;
        waypoints = GetComponent<WaypointManager>();
    }

    protected void Update()
    {
        // 每帧的按照waypoint去移动它的位置，到了位置后就进行下一个waypoint
        var position = transform.position;
        var target = waypoints.current.position;
        position = Vector3.MoveTowards(position, target, speed * Time.deltaTime);
        transform.position = position;

        if (Vector3.Distance(transform.position, target) == 0)
        {
            waypoints.Next();
        }
    }
}
```

按照原工程去拖预制体就行了。记得设置对应的waypoint

---

上升气流就是角色站在trigger里且浮空的时候给他一个向上的力

在Misc中新建脚本 GravityField

```csharp
public class GravityField : MonoBehaviour
{
    public float upwardForce = 75f;
    
    protected Collider m_collider;

    protected void Start()
    {
        m_collider = GetComponent<Collider>();
        m_collider.isTrigger = true;
    }

    protected void OnTriggerStay(Collider other)
    {
        // 就是在trigger范围内时，不在地面上时加一个向上的力，如果你想走进去就吹起来就不判断在不在地面上了
        if (other.CompareTag(GameTags.Player))
        {
            if (other.TryGetComponent<Player>(out var player))
            {
                if (player.isGrounded)
                {
                    player.verticalVelocity = Vector3.zero;
                }

                player.velocity += transform.up * upwardForce * Time.deltaTime;
            }
        }
    }
}
```

同样的，按照原工程去设置粒子特效，拖预制体，挂脚本，就完事了。