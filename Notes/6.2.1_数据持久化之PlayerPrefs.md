# 数据持久化之PlayerPrefs

PlayerPrefs是Unity提供的可以用于存储读取玩家数据的公共类

PlayerPrefs的数据存储是类似于键值对存储的，一个键对应一个值

键只能是string类型

值可以是 int，float，string类型，对应三种API

## 常用方法

### 存储

```csharp
PlayerPrefs.SetInt("age", 18);
PlayerPrefs.SetFloat("money", 123.23f);
PlayerPrefs.SetString("name", "player");
```

直接调用这些Set方法只会把数据存在内存里面，游戏结束时才会存储到硬盘里面。
如果游戏崩溃了，那么数据就丢失了。

使用这个方法主动把数据存到硬盘里

```csharp
PlayerPrefs.Save();
```

PlayerPrefs是有局限性的，只能存储3种类型的数据。
如果要存储其他类型的数据，只能自己想办法转换成它提供的这三种类型。

如果不同类型用同一键名进行存储，会进行覆盖。

### 读取

即使数据刚刚存进去，没有存在硬盘上，也能通过这些方法读取到

```csharp
int age = PlayerPrefs.GetInt("age");
int myage = PlayerPrefs.GetInt("myage", 20); // 这种是带默认值的读取方法，如果找不到这个键值对，那就返回后面填写的默认值
float money = PlayerPrefs.GetFloat("money");
string name = PlayerPrefs.GetString("name");
```

如果不同类型用同一键名进行存储，在覆盖之前的键值对后，使用原来类型的读取是找不到该键值对的，会返回默认值。

```csharp
PlayerPrefs.SetInt("age", 18);
PlayerPrefs.SetFloat("age", 20.0f);
int age = PlayerPrefs.GetInt("age"); // 结果为0
```

### 判断数据是否存在

```csharp
bool e = PlayerPrefs.HasKey("age");
```

### 删除

```csharp
// 删除对应键值对
PlayerPrefs.DeleteKey("age");
// 删除所有数据
PlayerPrefs.DeleteAll();
```

## 不同平台的存储位置

Windows：HKCU\Software\\[公司名称]\\[产品名称] 项下的注册表中，其中公司和产品名称是在Project Setting种设置的。

要查看该文件就需要使用注册表管理器，运行regedit。
HKEY_CURRENT_USER -> SOFTWARE -> Unity -> UnityEditor -> 公司名称 -> 产品名称

Android：直接存在xml文件里面

/data/data/包名/shared_prefs/pkg-name.xml

iOS：也是在一个文件中

/Library/Preferences/[应用ID].plist

## 数据唯一性

不同数据的唯一性是由key决定的，不同的key决定了不同的数据。

同一项目中，如果不同数据的key相同，则会造成数据丢失，要保证数据不丢失就要建立一个保证key唯一的规则。
