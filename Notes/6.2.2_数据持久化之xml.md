# 数据持久化之xml

这里关于xml的文件格式啥的就不多说了，主要介绍一下我们在Unity里面该怎么去用

## xml放在哪里

1. 只读xml可以放在Resources或StreamingAssets文件夹下
2. 动态存储的xml放在Application.persistentDataPath下

## 读取xml

xml 读写可以用这些工具

1. XmlDocument
2. XmlTextReader
3. Linq

我们这里使用XmlDocument

```csharp
XmlDocument xml = new XmlDocument();

// 假设我们的xml存在Resources下
TextAsset asset = Resources.Load<TextAsset>("文件名");
xml.LoadXml(asset.text);

// 假设存在StreamingAssets下或者其他可读写文件夹下
xml.Load(Application.streamingAssetsPath + "/Test.xml");
```

xml读到了，那还要把里面的元素信息获取到，我们的最终目的肯定是要把这些数据放到类成员里面去

假设我们有这样的一个xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<Root>
    <name>小红</name>
    <Item id="1" num="10"/>
    <Friend>
        <name>小明</name>
    </Friend>
    <Friend>
        <name>小强</name>
    </Friend>
</Root>
```

```csharp
// 获取xml中的根节点
XmlNode root = xml.SelectSingleNode("Root");
// 再获取子节点
XmlNode nodeName = root.SelectSingleNode("name");
// 获取节点包裹元素
print(nodeName.InnerText);
// 获取节点属性
XmlNode nodeItem = root.SelectSingleNode("Item");
print(nodeItem.Attributes["id"].Value);
print(nodeItem.Attributes.GetNamedItem("id").Value);

// 如果子节点中有重名的节点
XmlNodeList friendList = root.SelectNodes("Friend");
// 迭代器遍历
foreach (XmlNode node in friendList)
{
    print(node.SelectSingleNode("name").InnerText);
}
// for遍历
for (int i = 0; i < friendList.Count; i++)
{
    print(friendList[i].SelectSingleNode("name").InnerText);
}
```

## 存储xml

注意:存储xml文件在Unity中一定是使用各平台都可读可写可找到的路径

1. Resources 可读 不可写 打包后找不到
2. Application.streamingAssetsPath 可读 PC端可写 找得到
3. Application.dataPath 打包后找不到
4. Application.persistentDataPath 可读可写找得到

```cs
string path = Application.persistentDataPath + "/PlayerInfo.xml";

// 1. 创建文本对象
XmlDocument xml = new XmlDocument();
// 2. 添加版本信息
XmlDeclaration xmlDec = xml.CreateXmlDeclaration("1.0", "UTF-8", "");
// 往文本里面添加
xml.AppendChild(xmlDec);
// 3. 添加根节点
XmlElement root = xml.CreateElement("Root");
xml.AppendChild(root);
// 4. 给根节点添加子节点
XmlElement name = xml.CreateElement("name");
name.InnerText = "小红";
root.AppendChild(name);
// 添加属性
XmlElement item = xml.CreateElement("Item");
item.SetAttribute("id", "10");
item.AppendChild(root);
// 5. 保存
xml.Save(path);
```

## 修改xml

```cs
// 1. 判断文件是否存在

if (File.Exists(path))
{
    // 2. 加载后直接添加/移除节点即可
    XmlDocument newXml = new XmlDocument();
    newXml.Load(path);

    XmlNode root = newXml.SelectSingleNode("Root");
    root.SelectSingleNode("name").InnerText = "小明";
    // 或者
    XmlNode name = newXml.SelectSingleNode("Root/name");
    // 改属性和上面的代码一样，就不写了
    name.InnerText = "小明";
    // 移除子节点
    root.RemoveChild(name);

    // 改完要存
    newXml.Save(path);
}
```